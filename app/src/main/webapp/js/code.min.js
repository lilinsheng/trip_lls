window.callbackIndex=0;var positionUtil={_protocol:location.protocol.match(/^http(s{0,1}):$/g)?"":"https:",Base64:{table:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],UTF16ToUTF8:function(a){for(var b=[],c=a.length,d=0;d<c;d++){var e=a.charCodeAt(d);if(e>0&&e<=127)b.push(a.charAt(d));else if(e>=128&&e<=2047){var f=192|e>>6&31,g=128|63&e;b.push(String.fromCharCode(f),String.fromCharCode(g))}else if(e>=2048&&e<=65535){var f=224|e>>12&15,g=128|e>>6&63,h=128|63&e;b.push(String.fromCharCode(f),String.fromCharCode(g),String.fromCharCode(h))}}return b.join("")},UTF8ToUTF16:function(a){for(var b=[],c=a.length,d=0,d=0;d<c;d++){var e=a.charCodeAt(d);if(0==(e>>7&255))b.push(a.charAt(d));else if(6==(e>>5&255)){var f=a.charCodeAt(++d),g=(31&e)<<6,h=63&f,i=g|h;b.push(String.fromCharCode(i))}else if(14==(e>>4&255)){var f=a.charCodeAt(++d),j=a.charCodeAt(++d),g=e<<4|f>>2&15,h=(3&f)<<6|63&j;i=(255&g)<<8|h,b.push(String.fromCharCode(i))}}return b.join("")},encode:function(a){if(!a)return"";for(var b=this.UTF16ToUTF8(a),c=0,d=b.length,e=[];c<d;){var f=255&b.charCodeAt(c++);if(e.push(this.table[f>>2]),c==d){e.push(this.table[(3&f)<<4]),e.push("==");break}var g=b.charCodeAt(c++);if(c==d){e.push(this.table[(3&f)<<4|g>>4&15]),e.push(this.table[(15&g)<<2]),e.push("=");break}var h=b.charCodeAt(c++);e.push(this.table[(3&f)<<4|g>>4&15]),e.push(this.table[(15&g)<<2|(192&h)>>6]),e.push(this.table[63&h])}return e.join("")},decode:function(a){if(!a)return"";for(var b=a.length,c=0,d=[];c<b;){var e=this.table.indexOf(a.charAt(c++)),f=this.table.indexOf(a.charAt(c++)),g=this.table.indexOf(a.charAt(c++)),h=this.table.indexOf(a.charAt(c++)),i=e<<2|f>>4,j=(15&f)<<4|g>>2,k=(3&g)<<6|h;d.push(String.fromCharCode(i)),64!=g&&d.push(String.fromCharCode(j)),64!=h&&d.push(String.fromCharCode(k))}return this.UTF8ToUTF16(d.join(""))}},set:function(a,b){location.host.indexOf("lvmama")>-1?this.setRootCookie(a,this.Base64.encode(JSON.stringify(b)),".lvmama.com","/"):this.setRootCookie(a,this.Base64.encode(JSON.stringify(b)),"","/")},get:function(a){var b=this.Base64.decode(this.getCookie(a));return b?JSON.parse(b):""},defalutLocal:function(a){return a.latitude="31.238032669517935",a.longitude="121.38725332252167",a.cityName="上海",a.address="上海市普陀区怒江北路302弄6号",a.isFail=!0,a},getLocalPosition:function(a){var b={},c=this,d=navigator.userAgent,e=(d.indexOf("Mobile"),d.indexOf("LVMM"));if(-1!=d.indexOf("Windows Phone")&&-1!=d.indexOf("WebView"))return b=c.defalutLocal(b),void a(b);if(e>-1)return void(window.NativeUtil?NativeUtil.lvCommon("lvJSGetPlacemark",function(d){var d=JSON.parse(d);"1"==d.status?(b.cityName=d.returnValue.city,d.returnValue.city&&d.returnValue.county&&d.returnValue.address?(b.address=d.returnValue.city+d.returnValue.county+d.returnValue.address,NativeUtil.lvCommon("lvJSGetLocation",function(c){var c=JSON.parse(c);1==c.status&&(b.latitude=c.returnValue.latitude,b.longitude=c.returnValue.longitude,b.isFail=!1,a(b))})):(b=c.defalutLocal(b),a(b))):(b=c.defalutLocal(b),a(b))}):(b=c.defalutLocal(b),a(b)));var f=navigator.geolocation;if(!f)return b=c.defalutLocal(b),void a(b);var g=c.getCookie("lv_la"),h=c.getCookie("lv_lo");h&&g?c.getPosByCoords(g,h,a):f.getCurrentPosition(function(b){c.setRootCookie("lv_la",b.coords.latitude,".lvmama.com","/"),c.setRootCookie("lv_lo",b.coords.longitude,".lvmama.com","/"),c.getPosByCoords(b.coords.latitude,b.coords.longitude,a)},function(d){switch(b=c.defalutLocal(b),a(b),d.code){case d.PERMISSION_DENIED:console.log("GPS:用户拒绝对获取地理位置的请求。");break;case d.POSITION_UNAVAILABLE:console.log("GPS:位置信息是不可用的。");case d.TIMEOUT:console.log("GPS:请求用户地理位置超时。");break;case d.UNKNOWN_ERROR:console.log("GPS:未知错误。")}},{timeout:4e3})},getPosByCoords:function(a,b,c){var d={},e=this._protocol+"//api.map.baidu.com/geocoder/v2/?ak=VIqafisYEvp6E0j0j0DeWkny&callback=renderReverse&location="+a+","+b+"&output=json&pois=0&coordtype=wgs84ll&callback=JSON_CALLBACK"+ ++callbackIndex,f=document.createElement("script");f.type="text/javascript",f.src=e,document.getElementsByTagName("body")[0].appendChild(f),window["JSON_CALLBACK"+callbackIndex]=function(e){if(e.result){var f=e.result.addressComponent.city;""!=f||null!=f||void 0!=f?(d.latitude=a,d.longitude=b,d.cityName=f.replace(/[市|省]/g,""),d.isFail=!1,d.address=e.result.formatted_address,c(d)):(d=that.defalutLocal(d),c(d))}else d=that.defalutLocal(d),c(d)}},setPositionByName:function(a,b,c){var d=this,e={},f={},g={},h=d._protocol+"//m.lvmama.com/bullet/index.php?s=/HtmlLocalization/getCityStationInfo&cityName="+encodeURI(a),i=new XMLHttpRequest;i.open("get",h,!0),i.setRequestHeader("signal","ab4494b2-f532-4f99-b57e-7ca121a137ca"),i.onreadystatechange=function(){if(4==i.readyState)if(200==i.status){var a=navigator.userAgent,d=(a.indexOf("Mobile"),a.indexOf("LVMM")),h=JSON.parse(i.responseText);if(d>-1){var j={h5City:{fromDestId:h.datas.city.fromDestId,id:h.datas.city.id,isHot:h.datas.city.isHot,name:h.datas.city.name,pinyin:h.datas.city.pinyin,seq:h.datas.city.seq,shortPinyin:h.datas.city.shortPinyin,subName:h.datas.city.subName,provinceName:h.datas.city.provinceName},h5StationList:[{station_id:h.datas.station.station_id,pinyin:h.datas.station.pinyin,station_name:h.datas.station.station_name,station_code:h.datas.station.station_code,is_non_exist:h.datas.station.is_non_exist,type:"TICKET"},{station_id:h.datas.station.station_id,pinyin:h.datas.station.pinyin,station_name:h.datas.station.station_name,station_code:h.datas.station.station_code,is_non_exist:h.datas.station.is_non_exist,type:"ZBY"},{station_id:h.datas.station.station_id,pinyin:h.datas.station.pinyin,station_name:h.datas.station.station_name,station_code:h.datas.station.station_code,is_non_exist:h.datas.station.is_non_exist,type:"GNY"},{station_id:h.datas.station.station_id,pinyin:h.datas.station.pinyin,station_name:h.datas.station.station_name,station_code:h.datas.station.station_code,is_non_exist:h.datas.station.is_non_exist,type:"CJY"},{station_id:h.datas.station.station_id,pinyin:h.datas.station.pinyin,station_name:h.datas.station.station_name,station_code:h.datas.station.station_code,is_non_exist:h.datas.station.is_non_exist,type:"ROOT"},{station_id:h.datas.station.station_id,pinyin:h.datas.station.pinyin,station_name:h.datas.station.station_name,station_code:h.datas.station.station_code,is_non_exist:h.datas.station.is_non_exist,type:"ROUTE"}]};NativeUtil.lvCommon("lvJSSetNativeStationAndCity",j)}f.NAME=h.datas.city.name,f.FROMDESTID=h.datas.city.id,f.PINYIN=h.datas.city.pinyin,f.PROVINCENAME=h.datas.city.provinceName,g.NAME=h.datas.station.station_name,g.CODE=h.datas.station.station_code,g.PINYIN=h.datas.station.pinyin,g.STATIONID=h.datas.station.station_id,e.CITY=f,e.STATION=g,positionUtil.set("H5_CITY",e),b()}else c()},i.send(null)},getCookie:function(a){for(var b=document.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].split("=");if(this.trim(d[0])==a)return d[1]}},trim:function(a){return a.replace(/(^\s*)|(\s*$)/g,"")},setRootCookie:function(a,b,c,d){var e=c,f=d;e=e?";domain="+e:"",f=f?";path="+f:"";var g=new Date;"lv_la"===a||"lv_lo"===a?g.setTime(g.getTime()+18e5):g.setTime(g.getTime()+216e5),document.cookie=a+"="+b+e+f+";expires="+g},defaultposition:function(a){var b={},c={},d={};c.NAME="上海",c.FROMDESTID=9,c.PINYIN="shanghai",c.PROVINCENAME="上海",d.NAME="上海",d.CODE="SH",d.PINYIN="shanghai",d.STATIONID=1,b.CITY=c,b.STATION=d,positionUtil.set("H5_CITY",b),a(b)},cityWithApp:function(a){var b=positionUtil.get("H5_CITY");NativeUtil&&NativeUtil.lvCommon("lvJSGetUserDefaultWithKey",{key:"routeFromDestDic"},function(c){var c=JSON.parse(c);c.returnValue.name!=a&&b&&(void 0==b.STATION.STATIONID||NativeUtil.isGreaterThan("7.9.3")?positionUtil.setPositionByName(c.returnValue.name,function(){NativeUtil.lvCommon("lvJSRefreshWebView",{})}):NativeUtil.lvCommon("lvJSRefreshWebView",{}))}),!NativeUtil&&loadScript("//pics.lvjs.com.cn/mobile/lib/plugins/nativeUtil/1.0/nativeUtil-1.9.3.min.js",function(){NativeUtil.lvCommon("lvJSGetUserDefaultWithKey",{key:"routeFromDestDic"},function(c){var c=JSON.parse(c);c.returnValue.name!=a&&b&&(void 0==b.STATION.STATIONID?positionUtil.setPositionByName(c.returnValue.name,function(){NativeUtil.lvCommon("lvJSRefreshWebView",{})}):NativeUtil.lvCommon("lvJSRefreshWebView",{}))})})},getInfoByName:function(a,b){var c={},d={},e={},f=this,g=f._protocol+"//m.lvmama.com/bullet/index.php?s=/HtmlLocalization/getCityStationInfo&cityName="+encodeURI(a),h=new XMLHttpRequest;h.open("get",g,!0),h.setRequestHeader("signal","ab4494b2-f532-4f99-b57e-7ca121a137ca"),h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status){var a=JSON.parse(h.responseText);d.NAME=a.datas.city.name,d.FROMDESTID=a.datas.city.id,d.PINYIN=a.datas.city.pinyin,d.PROVINCENAME=a.datas.city.provinceName,e.NAME=a.datas.station.station_name,e.CODE=a.datas.station.station_code,e.PINYIN=a.datas.station.pinyin,e.STATIONID=a.datas.station.station_id,c.CITY=d,c.STATION=e,positionUtil.set("H5_CITY",c),b(c)}else positionUtil.defaultposition(b)},h.send(null)}};positionUtil.getposition=function(a){var b=navigator.userAgent;b.indexOf("Mobile"),b.indexOf("LVMM");if(location.href.indexOf("http://")<0&&location.href.indexOf("https://")<0)return void NativeUtil.lvCommon("lvJSGetUserDefaultWithKey",{key:"routeFromDestDic"},function(b){var b=JSON.parse(b);positionUtil.getInfoByName(b.returnValue.name,a)});var c=positionUtil.get("H5_CITY");if(c)return void(void 0==c.STATION.STATIONID?positionUtil.getInfoByName(c.CITY.NAME,a):a(c));positionUtil.getLocalPosition(function(b){positionUtil.getInfoByName(b.cityName,a)})};